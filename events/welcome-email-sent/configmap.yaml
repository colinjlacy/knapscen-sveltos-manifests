apiVersion: v1
kind: ConfigMap
metadata:
  name: welcome-email-job
  namespace: projectsveltos
  annotations:
    projectsveltos.io/instantiate: "ok"
data:
  job.yaml: |
    apiVersion: batch/v1
    kind: Job
    metadata:
      name: welcome-email-{{ .CloudEvent.subject }}
      namespace: knapscen-jobs
    spec:
      ttlSecondsAfterFinished: 300
      template:
        spec:
          restartPolicy: OnFailure
          containers:
          - name: send-welcome-email
            image: knapscen/send-welcome-email:latest
            env:
            - name: CUSTOMER_ID
              value: "{{ .CloudEvent.subject }}"
            - name: CUSTOMER_NAME
              value: "{{ .CloudEvent.data.customer_name }}"
            - name: PRIMARY_EMAIL
              value: "{{ .CloudEvent.data.primary_email }}"
            - name: SUBSCRIPTION_TIER
              value: "{{ .CloudEvent.data.subscription_tier }}"
            - name: EVENT_ID
              value: "{{ .CloudEvent.id }}"
            - name: EVENT_TIME
              value: "{{ .CloudEvent.time }}"

